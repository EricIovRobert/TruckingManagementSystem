{% extends 'base.html.twig' %}

{% block title %}Adaugă Tur{% endblock %}

{% block body %}
    <div class="form-container shadow-sm rounded-3 bg-white p-4" style="max-width: 600px; margin: 0 auto;">
        <h1 class="text-center mb-4">Adaugă Tur pentru Comanda #{{ comanda.id }}</h1>
        {{ form_start(form) }}
            <div class="row g-3">
                <div class="col-md-6">
                    {{ form_label(form.firma) }}
                    {{ form_widget(form.firma, {'attr': {'class': 'form-control'}}) }}
                </div>
                <div class="col-md-6">
                    {{ form_label(form.rutaIncarcare) }}
                    {{ form_widget(form.rutaIncarcare, {'attr': {'class': 'form-control'}}) }}
                </div>
                <div class="col-md-6">
                    {{ form_label(form.rutaDescarcare) }}
                    {{ form_widget(form.rutaDescarcare, {'attr': {'class': 'form-control'}}) }}
                </div>
                <div class="col-md-6">
                    {{ form_label(form.kg) }}
                    {{ form_widget(form.kg, {'attr': {'class': 'form-control'}}) }}
                </div>
                <div class="col-md-6">
                    {{ form_label(form.pret) }}
                    {{ form_widget(form.pret, {'attr': {'class': 'form-control'}}) }}
                </div>
                <div class="col-md-6">
                    {{ form_label(form.liber) }}
                    {{ form_widget(form.liber, {'attr': {'class': 'form-control'}}) }}
                </div>
             
                <div class="col-md-6">
                    {{ form_label(form.moneda) }}
                    {{ form_widget(form.moneda, {'attr': {'class': 'form-control'}}) }}
                </div>
            </div>
            <div class="button-group mt-4 d-flex justify-content-between">
                <a href="{{ path('app_comenzi_show', {'id': comanda.id}) }}" class="btn btn-secondary">Înapoi la detalii</a>
                <button type="submit" class="btn btn-primary">Salvează</button>
            </div>
        {{ form_end(form) }}
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const pretField = document.querySelector('[name="tururi[pret]"]');
            const monedaField = document.querySelector('[name="tururi[moneda]"]');
            let cursEurRon = 0;

            // Preluăm cursul valutar din API
            fetch('/api/curs-valutar', {
                method: 'GET',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.json())
            .then(data => {
                cursEurRon = data.conversion_rates.RON;
            })
            .catch(error => {
                console.error('Eroare la preluarea cursului valutar:', error);
                cursEurRon = 5; // Valoare fallback
            });

            // Funcție pentru recalcularea prețului
            function recalcPret() {
                let pret = parseFloat(pretField.value) || 0;
                if (monedaField.value === 'EUR') {
                    pret = pret * cursEurRon;
                }
                pretField.value = pret.toFixed(2);
            }

            // Adăugăm listener doar pe schimbarea monedei
            monedaField.addEventListener('change', recalcPret);
        });
    </script>
{% endblock %}